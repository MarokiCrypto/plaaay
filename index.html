<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>INSTAPlay â€” Demo Ù…Ø¹ Ø´Ø­Ù†/Ø³Ø­Ø¨ ÙˆÙˆÙƒÙ„Ø§Ø¡</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg-1:#feda75;--bg-2:#fa7e1e;--bg-3:#d62976;--bg-4:#962fbf;
    --card-radius:16px;--accent-white:#ffffff;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:"Tajawal",sans-serif;background:linear-gradient(135deg,var(--bg-1),var(--bg-2),var(--bg-3),var(--bg-4));min-height:100vh;color:var(--accent-white);padding:16px}
  .wrap{max-width:420px;margin:0 auto}
  header{display:flex;justify-content:space-between;align-items:center;padding:10px;background:rgba(0,0,0,0.12);border-radius:12px}
  #logoTap{display:flex;gap:10px;align-items:center;cursor:pointer}
  .icon{width:44px;height:44px;border-radius:10px;background:linear-gradient(45deg,var(--bg-3),var(--bg-4));display:flex;align-items:center;justify-content:center;font-weight:800}
  .badge{background:rgba(255,255,255,0.08);padding:6px 8px;border-radius:10px;font-size:13px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.12));padding:12px;border-radius:12px;margin-top:12px;box-shadow:0 8px 30px rgba(0,0,0,0.2)}
  label{display:block;margin-top:8px;font-size:13px;color:rgba(255,255,255,0.9)}
  input,select,textarea,button{width:100%;padding:10px;border-radius:10px;border:0;background:rgba(255,255,255,0.06);color:#fff;margin-top:8px;font-family:inherit}
  textarea{min-height:80px;resize:vertical}
  .row{display:flex;gap:8px}
  .btn{background:linear-gradient(90deg,var(--bg-3),var(--bg-4));font-weight:700;cursor:pointer;border-radius:10px}
  .muted{font-size:13px;color:rgba(255,255,255,0.85)}
  .small{font-size:12px}
  .hidden{display:none}
  .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:9999}
  .modal .panel{width:94%;max-width:420px;background:#0b0b0b;padding:14px;border-radius:12px}
  .chip{display:inline-block;padding:8px 10px;border-radius:10px;background:rgba(255,255,255,0.03);cursor:pointer}
  .list-bank{display:flex;flex-direction:column;gap:8px}
  .agents{display:flex;flex-direction:column;gap:8px;margin-top:8px}
  .agent-item{display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,0.03);padding:8px;border-radius:8px}
  footer{margin-top:12px;text-align:center;font-size:12px;color:rgba(255,255,255,0.8)}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div id="logoTap" title="Ø§Ø¶ØºØ· 6 Ù…Ø±Ø§Øª Ù„ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…ÙŠÙ†">
        <div class="icon">IP</div>
        <div>
          <div style="font-weight:800">INSTAPlay</div>
          <div class="muted small">Ø£Ù„Ø¹Ø§Ø¨ â€” Ù‡Ø§ØªÙ</div>
        </div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <div id="notifyDot" class="badge hidden">Ø¬Ø¯ÙŠØ¯</div>
        <div id="adminBadgePlaceholder"></div>
      </div>
    </header>

    <!-- ØªØ³Ø¬ÙŠÙ„ -->
    <div class="card" id="authCard">
      <div class="muted">Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ Ø³Ø±ÙŠØ¹</div>
      <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
      <input id="name" placeholder="Ù…Ø«Ø§Ù„: Ø£Ù…ÙŠÙ†">
      <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
      <input id="email" placeholder="email@example.com">
      <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
      <input id="pass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±">
      <div style="display:flex;gap:8px;margin-top:8px">
        <select id="role" style="width:50%">
          <option value="player">Ù„Ø§Ø¹Ø¨</option>
          <option value="vip">VIP</option>
        </select>
        <button id="registerBtn" class="btn" style="width:50%">ØªØ³Ø¬ÙŠÙ„ & Ø¯Ø®ÙˆÙ„</button>
      </div>
      <div class="muted small" style="margin-top:8px">Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ù…Ø­Ù„ÙŠØ©: ÙŠØ¹Ø±Ø¶ Ø±ØµÙŠØ¯ ÙˆÙ‡Ù…ÙŠ ÙˆÙŠÙØ³Ø¬Ù„ ÙÙŠ Ù…ØªØµÙØ­Ùƒ ÙÙ‚Ø·.</div>
    </div>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
    <div class="card hidden" id="dashCard">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="font-weight:800" id="uName">-</div>
          <div class="muted small">ID: <span id="uId">-</span></div>
        </div>
        <div style="text-align:right">
          <div class="muted small">Ø§Ù„Ø±ØµÙŠØ¯</div>
          <div style="font-weight:900;font-size:18px" id="uBal">0</div>
        </div>
      </div>

      <div style="display:flex;gap:8px;margin-top:10px">
        <button id="openDeposit" class="btn" style="flex:1">Ø´Ø­Ù†</button>
        <button id="openWithdraw" class="btn" style="flex:1;background:linear-gradient(90deg,#ef4444,#f97316)">Ø³Ø­Ø¨</button>
      </div>

      <div style="margin-top:10px;display:flex;gap:8px">
        <button id="playGamesBtn" class="btn" style="flex:1;background:linear-gradient(90deg,#6b7280,#374151)">Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</button>
        <button id="logoutBtn" class="btn" style="flex:1;background:linear-gradient(90deg,#111827,#374151)">Ø®Ø±ÙˆØ¬</button>
      </div>
    </div>

    <!-- Ø£Ù„Ø¹Ø§Ø¨ Ù…Ø¨Ø³Ø·Ø© -->
    <div class="card hidden" id="gamesCard">
      <h3>Ø£Ù„Ø¹Ø§Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠØ©</h3>
      <div class="muted small">Ø§Ø¶ØºØ· Ù„Ù„Ø¹Ø¨ â€” ÙƒÙ„ Ù„Ø¹Ø¨Ø© ØªØºÙŠØ± Ø§Ù„Ø±ØµÙŠØ¯ ÙˆØªØ±Ø§Ø¹ÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø£Ø¯Ù…ÙŠÙ†</div>
      <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
        <button onclick="playCoin('Heads')" class="btn">ğŸª™ Coin (Heads)</button>
        <button onclick="playDice()" class="btn">ğŸ² Dice</button>
        <button onclick="playRPS('âœŠ')" class="btn">âœŠ RPS</button>
        <button onclick="playSlot()" class="btn">ğŸ° Slot</button>
        <button onclick="resetMines()" class="btn" style="background:linear-gradient(90deg,#10b981,#059669)">ğŸ’£ Reset Mines</button>
      </div>
      <div id="gameMsg" class="muted small" style="margin-top:10px"></div>
      <div id="gameResult" class="muted small" style="margin-top:6px"></div>
    </div>

    <!-- Agents display -->
    <div class="card hidden" id="agentsCard">
      <h3>ÙˆÙƒÙ„Ø§Ø¡ Ù…Ø¹ØªÙ…Ø¯ÙŠÙ† Ù„Ù„Ø´Ø­Ù†</h3>
      <div class="muted small">ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„ÙˆÙƒÙŠÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø­Ù† (ÙˆÙ‡Ù…ÙŠ Ù„Ù„ØªØ¬Ø±Ø¨Ø©)</div>
      <div class="agents">
        <!-- example agent -->
        <div class="agent-item">
          <div>ÙˆÙƒÙŠÙ„ Ø±Ø³Ù…ÙŠ â€” ÙˆØ§ØªØ³Ø§Ø¨: +212 713-041921</div>
          <div style="display:flex;gap:8px">
            <a id="agentWA" class="chip" target="_blank" rel="noreferrer" href="https://wa.me/212713041921">ÙˆØ§ØªØ³Ø§Ø¨</a>
            <button class="chip" onclick="useAgent('+212713041921')">Ø§Ø®ØªØ± Ø§Ù„ÙˆÙƒÙŠÙ„</button>
          </div>
        </div>
      </div>
    </div>

    <footer>Â© INSTAPlay â€” Demo</footer>
  </div>

  <!-- Deposit Modal -->
  <div id="depositModal" class="modal hidden" aria-hidden="true">
    <div class="panel" style="background:#071013;padding:14px;border-radius:12px;max-width:420px;width:94%">
      <h3>Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯</h3>
      <div class="muted small">Ø§Ø®ØªØ± Ø¨Ù†ÙƒÙƒ Ø«Ù… Ø§Ù…Ù„Ø£ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­ÙˆØ§Ù„Ø© / Ø§Ù„Ø¥ÙŠØµØ§Ù„</div>
      <label>Ø§Ù„Ø¨Ù†Ùƒ</label>
      <div class="list-bank">
        <select id="depositBank">
          <option value="CIH">CIH</option>
          <option value="Attijari">Attijari</option>
          <option value="Banque Populaire">Banque Populaire</option>
          <option value="Al Barid">Al Barid</option>
          <option value="Cash Plus">Cash Plus</option>
          <option value="Orange Money">Orange Money</option>
        </select>
      </div>
      <label>Ø§Ù„Ù…Ø¨Ù„Øº (Ø¯Ø±Ù‡Ù…)</label>
      <input id="depositAmount" type="number" placeholder="Ù…Ø«Ø§Ù„: 100">
      <label>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ (Ø±Ù‚Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„ / Ù…Ù„Ø§Ø­Ø¸Ø§Øª)</label>
      <textarea id="depositInfo" placeholder="Ø¶Ø¹ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ùˆ Ù…Ø¹Ø±Ù Ø§Ù„Ø­ÙˆØ§Ù„Ø©"></textarea>

      <div style="display:flex;gap:8px;margin-top:12px">
        <button id="sendDeposit" class="btn" style="flex:1">Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø­Ù†</button>
        <button onclick="closeDeposit()" class="chip" style="flex:1">Ø¥Ù„ØºØ§Ø¡</button>
      </div>

      <div id="depositMsg" class="muted small" style="margin-top:10px"></div>
    </div>
  </div>

  <!-- Withdraw Modal -->
  <div id="withdrawModal" class="modal hidden" aria-hidden="true">
    <div class="panel" style="background:#10070b;padding:14px;border-radius:12px;max-width:420px;width:94%">
      <h3>Ø·Ù„Ø¨ Ø³Ø­Ø¨</h3>
      <div class="muted small">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø³Ø­Ø¨ ÙÙŠÙ‡ ÙˆØ§Ù…Ù„Ø£ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</div>
      <label>Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø³ØªÙ„Ù…</label>
      <select id="withdrawBank">
        <option value="CIH">CIH</option>
        <option value="Attijari">Attijari</option>
        <option value="Banque Populaire">Banque Populaire</option>
        <option value="Al Barid">Al Barid</option>
        <option value="Cash Plus">Cash Plus</option>
        <option value="Orange Money">Orange Money</option>
      </select>
      <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø±Ø§Ø¯ Ø³Ø­Ø¨Ù‡ (Ø¯Ø±Ù‡Ù…)</label>
      <input id="withdrawAmount" type="number" placeholder="Ù…Ø«Ø§Ù„: 50">
      <label>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ (Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ / Ø§Ù„Ø§Ø³Ù… / Ù…Ù„Ø§Ø­Ø¸Ø©)</label>
      <textarea id="withdrawInfo" placeholder="Ù…Ø«Ø§Ù„: Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ / Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ"></textarea>

      <div style="display:flex;gap:8px;margin-top:12px">
        <button id="sendWithdraw" class="btn" style="flex:1;background:linear-gradient(90deg,#ef4444,#f97316)">Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨</button>
        <button onclick="closeWithdraw()" class="chip" style="flex:1">Ø¥Ù„ØºØ§Ø¡</button>
      </div>

      <div id="withdrawMsg" class="muted small" style="margin-top:10px"></div>
    </div>
  </div>

  <!-- Admin secret modal -->
  <div id="adminModal" class="modal hidden" aria-hidden="true">
    <div class="panel" style="background:#050812">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:800">Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…ÙŠÙ† (Ø³Ø±ÙŠØ©)</div>
        <div id="closeAdmin" class="chip">Ø¥ØºÙ„Ø§Ù‚</div>
      </div>

      <!-- create / login -->
      <div id="adminCreateWrap" class="hidden" style="margin-top:10px">
        <h4>Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø¯Ù…ÙŠÙ† Ø³Ø±ÙŠ</h4>
        <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¸Ø§Ù‡Ø±</label>
        <input id="adminCreateName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ø¯Ù…ÙŠÙ† Ù„Ù„Ø¹Ø±Ø¶">
        <label>Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø±ÙŠ</label>
        <input id="adminCreateCode" type="password">
        <label>ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯</label>
        <input id="adminCreateCode2" type="password">
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="createAdminBtn" class="btn" style="flex:1">Ø¥Ù†Ø´Ø§Ø¡ & ØªØ´ÙÙŠØ±</button>
          <button id="cancelCreate" class="chip" style="flex:1">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
        <div id="createMsg" class="muted small" style="margin-top:8px"></div>
      </div>

      <div id="adminLoginWrap" class="hidden" style="margin-top:10px">
        <h4>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…ÙŠÙ†</h4>
        <label>Ø§Ù„Ø§Ø³Ù…</label>
        <input id="adminLoginName">
        <label>Ø§Ù„ÙƒÙˆØ¯</label>
        <input id="adminLoginCode" type="password">
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="loginAdminBtn" class="btn" style="flex:1">Ø¯Ø®ÙˆÙ„</button>
          <button id="showCreateBtn" class="chip" style="flex:1">Ø£Ù†Ø´Ø¦ Ø¬Ø¯ÙŠØ¯</button>
        </div>
        <div id="loginMsg" class="muted small" style="margin-top:8px"></div>
      </div>

      <div id="adminPanelWrap" class="hidden" style="margin-top:10px">
        <h4>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…ÙŠÙ†</h4>
        <div class="muted small">Ø§Ù„Ø§Ø³Ù…: <b id="adminNameDisplay">-</b></div>
        <div style="margin-top:10px">
          <div class="muted small">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©</div>
          <div id="adminNotif" style="font-weight:700;margin-top:6px"></div>
        </div>

        <div style="margin-top:12px">
          <div class="muted small">Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ø§Ù…</div>
          <div style="display:flex;gap:6px;margin-top:6px">
            <button id="setForceWin" class="chip">Ø±Ø¨Ø­ Ø¯Ø§Ø¦Ù…</button>
            <button id="setForceLose" class="chip">Ø®Ø³Ø§Ø±Ø© Ø¯Ø§Ø¦Ù…</button>
            <button id="setNormal" class="chip">Ø¹Ø§Ø¯ÙŠ</button>
          </div>
          <div class="muted small" style="margin-top:8px">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ: <b id="adminModeLabel">Ø¹Ø§Ø¯ÙŠ</b></div>
        </div>

        <div style="margin-top:12px">
          <div class="muted small">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
          <div class="users-list" id="usersList" style="margin-top:8px"></div>
        </div>

        <div style="margin-top:12px">
          <div class="muted small">ØªØºÙŠÙŠØ± ÙƒÙˆØ¯ (ÙŠØªØ·Ù„Ø¨ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…)</div>
          <input id="oldCode" type="password" placeholder="Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…">
          <input id="newCode" type="password" placeholder="Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
          <input id="newCode2" type="password" placeholder="ØªØ£ÙƒÙŠØ¯">
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="changeCodeBtn" class="btn" style="flex:1">ØªØºÙŠÙŠØ± Ø§Ù„ÙƒÙˆØ¯</button>
            <button id="logoutAdminBtn" class="chip" style="flex:1">Ø®Ø±ÙˆØ¬</button>
          </div>
          <div id="adminActionMsg" class="muted small" style="margin-top:6px"></div>
        </div>

      </div>

      <div style="margin-top:12px" class="muted small">Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ù‡ Ù†Ø§ÙØ°Ø© Ø³Ø±ÙŠØ© â€” Ù„ÙØªØ­Ù‡Ø§ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø¹Ø§Ø± 6 Ù…Ø±Ø§Øª.</div>
    </div>
  </div>

<script>
/* -------------------------
   Helpers: hashing & storage
   ------------------------- */
async function sha256Hex(message){
  const enc = new TextEncoder();
  const data = enc.encode(message);
  const hash = await crypto.subtle.digest('SHA-256', data);
  const arr = Array.from(new Uint8Array(hash));
  return arr.map(b=>b.toString(16).padStart(2,'0')).join('');
}
function randBase64(lenBytes=12){
  const a=new Uint8Array(lenBytes);
  crypto.getRandomValues(a);
  let s='';
  for(let i=0;i<a.length;i++) s += String.fromCharCode(a[i]);
  return btoa(s);
}

/* Admin stored: {name, salt, hash} under key 'insta_admin' */
function getAdminStored(){ try{ return JSON.parse(localStorage.getItem('insta_admin')||'null'); }catch(e){return null;} }
function setAdminStored(o){ localStorage.setItem('insta_admin', JSON.stringify(o)); }

/* users list stored under insta_users */
function loadUsers(){ try{return JSON.parse(localStorage.getItem('insta_users')||'[]')}catch(e){return []} }
function saveUsers(u){ localStorage.setItem('insta_users', JSON.stringify(u)); }
function pushNotif(msg){ localStorage.setItem('insta_last_notif', JSON.stringify({t:new Date().toISOString(), m: msg})); }
function setAdminMode(mode){ localStorage.setItem('insta_admin_mode', mode); }
function getAdminMode(){ return localStorage.getItem('insta_admin_mode') || 'normal'; }

/* demo current user saved under insta_current_user */
function saveCurrentUser(u){ localStorage.setItem('insta_current_user', JSON.stringify(u)); }
function loadCurrentUser(){ try{ return JSON.parse(localStorage.getItem('insta_current_user')||'null')}catch(e){return null} }

/* -------------------------
   Registration / UI wiring
   ------------------------- */
const registerBtn = document.getElementById('registerBtn');
const nameIn = document.getElementById('name');
const emailIn = document.getElementById('email');
const passIn = document.getElementById('pass');
const roleSel = document.getElementById('role');

const dashCard = document.getElementById('dashCard');
const uNameEl = document.getElementById('uName');
const uIdEl = document.getElementById('uId');
const uBalEl = document.getElementById('uBal');

const openDepositBtn = document.getElementById('openDeposit');
const openWithdrawBtn = document.getElementById('openWithdraw');
const playGamesBtn = document.getElementById('playGamesBtn');
const logoutBtn = document.getElementById('logoutBtn');

registerBtn.addEventListener('click', ()=>{
  const name = nameIn.value.trim() || 'Ù„Ø§Ø³Ù…';
  const email = emailIn.value.trim() || '';
  const pass = passIn.value || '';
  if(!name || !email || !pass){ alert('Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„'); return; }
  const users = loadUsers();
  const id = 'u' + Date.now().toString(36).slice(-6);
  const user = {id, name, email, pass, role: roleSel.value, balance: 100, created: new Date().toISOString()};
  users.push(user);
  saveUsers(users);
  saveCurrentUser(user);
  pushNotif(`ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯: ${name} (${email})`);
  // clear
  nameIn.value=''; emailIn.value=''; passIn.value='';
  showUser();
});

function showUser(){
  const u = loadCurrentUser();
  if(!u) return;
  dashCard.classList.remove('hidden');
  document.getElementById('authCard').classList && document.getElementById('authCard').classList.add('hidden');
  uNameEl.innerText = u.name;
  uIdEl.innerText = u.id;
  uBalEl.innerText = u.balance;
  // show agents & games
  document.getElementById('agentsCard').classList.remove('hidden');
}

showUser();

/* logout */
logoutBtn.addEventListener('click', ()=>{
  localStorage.removeItem('insta_current_user');
  dashCard.classList.add('hidden');
  document.getElementById('authCard').classList.remove('hidden');
  document.getElementById('gamesCard').classList.add('hidden');
  document.getElementById('agentsCard').classList.add('hidden');
});

/* open deposit/withdraw/games */
openDepositBtn.addEventListener('click', ()=> openDeposit());
openWithdrawBtn.addEventListener('click', ()=> openWithdraw());
playGamesBtn.addEventListener('click', ()=> {
  document.getElementById('gamesCard').classList.toggle('hidden');
});

/* -------------------------
   Deposit flow
   ------------------------- */
const depositModal = document.getElementById('depositModal');
const depositAmount = document.getElementById('depositAmount');
const depositBank = document.getElementById('depositBank');
const depositInfo = document.getElementById('depositInfo');
const depositMsg = document.getElementById('depositMsg');
document.getElementById('sendDeposit').addEventListener('click', sendDeposit);

function openDeposit(){ depositMsg.innerText=''; depositAmount.value=''; depositInfo.value=''; depositModal.classList.remove('hidden'); depositModal.setAttribute('aria-hidden','false'); }
function closeDeposit(){ depositModal.classList.add('hidden'); depositModal.setAttribute('aria-hidden','true'); }

function sendDeposit(){
  const amt = parseInt(depositAmount.value);
  if(isNaN(amt) || amt<=0){ depositMsg.innerText='Ø§Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº ØµØ§Ù„Ø­'; return; }
  const bank = depositBank.value;
  const info = depositInfo.value.trim();
  const u = loadCurrentUser();
  if(!u){ depositMsg.innerText='Ø³Ø¬Ù‘Ù„ Ø£ÙˆÙ„Ø§'; return; }

  // record pending deposit
  const tx = {type:'deposit', userId: u.id, amount: amt, bank, info, t: new Date().toISOString()};
  localStorage.setItem('insta_last_tx', JSON.stringify(tx));
  pushNotif(`Ø·Ù„Ø¨ Ø´Ø­Ù†: ${u.name} â€” ${amt} Ø¯Ø±Ù‡Ù…`);

  // instant message then delayed credit
  depositMsg.innerText = 'ØªÙ… Ø§Ù„Ø´Ø­Ù† â€” Ø³ØªØªÙˆØµÙ„ Ø¨Ø±ØµÙŠØ¯Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹';
  // simulate processing delay then credit
  setTimeout(()=>{
    // credit user
    const users = loadUsers();
    const idx = users.findIndex(x=>x.id===u.id);
    if(idx!==-1){ users[idx].balance = (users[idx].balance||0) + amt; saveUsers(users); saveCurrentUser(users[idx]); showUser(); }
    depositMsg.innerText = 'ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­ â€” ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ØµÙŠØ¯';
    pushNotif(`Ø´Ø­Ù† Ù…ÙØ¹Ø§Ù„Ø¬: ${u.name} +${amt} Ø¯Ø±Ù‡Ù…`);
    localStorage.setItem('insta_last_tx', JSON.stringify({type:'deposit_done', userId:u.id, amount:amt, t:new Date().toISOString()}));
  }, 2000);

  // close modal after short delay visually
  setTimeout(()=>{ closeDeposit(); }, 2600);
}

/* -------------------------
   Withdraw flow
   ------------------------- */
const withdrawModal = document.getElementById('withdrawModal');
const withdrawBank = document.getElementById('withdrawBank');
const withdrawAmount = document.getElementById('withdrawAmount');
const withdrawInfo = document.getElementById('withdrawInfo');
const withdrawMsg = document.getElementById('withdrawMsg');
document.getElementById('sendWithdraw').addEventListener('click', sendWithdraw);

function openWithdraw(){ withdrawMsg.innerText=''; withdrawAmount.value=''; withdrawInfo.value=''; withdrawModal.classList.remove('hidden'); withdrawModal.setAttribute('aria-hidden','false'); }
function closeWithdraw(){ withdrawModal.classList.add('hidden'); withdrawModal.setAttribute('aria-hidden','true'); }

function sendWithdraw(){
  const amt = parseInt(withdrawAmount.value);
  if(isNaN(amt) || amt<=0){ withdrawMsg.innerText='Ø§Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº ØµØ§Ù„Ø­'; return; }
  const bank = withdrawBank.value;
  const info = withdrawInfo.value.trim();
  const u = loadCurrentUser();
  if(!u){ withdrawMsg.innerText='Ø³Ø¬Ù‘Ù„ Ø£ÙˆÙ„Ø§'; return; }
  if((u.balance||0) < amt){ withdrawMsg.innerText='Ø§Ù„Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙ'; return; }

  // deduct immediately
  const users = loadUsers();
  const idx = users.findIndex(x=>x.id===u.id);
  if(idx===-1){ withdrawMsg.innerText='Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'; return; }
  users[idx].balance = Math.max(0, users[idx].balance - amt);
  saveUsers(users);
  saveCurrentUser(users[idx]);
  showUser();

  // record tx
  const tx = {type:'withdraw', userId: u.id, amount: amt, bank, info, t: new Date().toISOString()};
  localStorage.setItem('insta_last_tx', JSON.stringify(tx));
  pushNotif(`Ø·Ù„Ø¨ Ø³Ø­Ø¨: ${u.name} â€” ${amt} Ø¯Ø±Ù‡Ù…`);

  withdrawMsg.innerText = 'ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­ â€” Ø³Ø­Ø¨ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©';
  setTimeout(()=>{ closeWithdraw(); }, 1600);
}

/* -------------------------
   Agents (fake) handling
   ------------------------- */
function useAgent(number){
  alert('ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙˆÙƒÙŠÙ„ â€” Ø§ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ØªÙˆØ§ØµÙ„: ' + number);
  // open WA
  const link = 'https://wa.me/' + number.replace(/\D/g,'');
  window.open(link, '_blank');
}

/* -------------------------
   Games (integrated with admin mode)
   ------------------------- */
function applyResult(delta, message){
  const u = loadCurrentUser();
  if(!u){ alert('Ø³Ø¬Ù‘Ù„ Ø£ÙˆÙ„Ø§'); return; }
  const users = loadUsers();
  const idx = users.findIndex(x=>x.id===u.id);
  if(idx===-1) return;
  users[idx].balance = Math.max(0, (users[idx].balance||0) + delta);
  saveUsers(users);
  saveCurrentUser(users[idx]);
  showUser();
  document.getElementById('gameMsg').innerText = message;
  // log tx
  localStorage.setItem('insta_last_tx', JSON.stringify({type:'game', userId:u.id, amount:delta, msg:message, t:new Date().toISOString()}));
  pushNotif(`Ù„Ø¹Ø¨: ${u.name} â€” ${message}`);
}

function playCoin(choice){
  const mode = getAdminMode();
  let result = Math.random() < 0.5 ? 'Heads' : 'Tails';
  if(mode === 'win') result = choice;
  if(mode === 'lose') result = (choice === 'Heads' ? 'Tails' : 'Heads');
  if(result === choice) applyResult(+10, `ÙØ²Øª +10 (${result})`);
  else applyResult(-5, `Ø®Ø³Ø±Øª -5 (${result})`);
}
function playDice(){
  const mode = getAdminMode();
  let r = Math.floor(Math.random()*6)+1;
  if(mode === 'win') r = 6;
  if(mode === 'lose') r = 1;
  if(r === 6) applyResult(+10, `ğŸ‰ 6 â€” ÙØ²Øª +10`);
  else if(r >= 4) applyResult(+5, `+5 â€” Ù†ØªÙŠØ¬Ø© ${r}`);
  else applyResult(-5, `-5 â€” Ù†ØªÙŠØ¬Ø© ${r}`);
}
function playRPS(p){
  const opts=['âœŠ','âœ‹','âœŒï¸'];
  let comp = opts[Math.floor(Math.random()*3)];
  const mode = getAdminMode();
  if(mode === 'win'){ comp = (p === 'âœŠ' ? 'âœŒï¸' : p === 'âœ‹' ? 'âœŠ' : 'âœ‹'); }
  if(mode === 'lose'){ comp = (p === 'âœŠ' ? 'âœ‹' : p === 'âœ‹' ? 'âœŒï¸' : 'âœŠ'); }
  let res='';
  if(p === comp) res = 'ØªØ¹Ø§Ø¯Ù„';
  else if((p==='âœŠ'&&comp==='âœŒï¸')||(p==='âœ‹'&&comp==='âœŠ')||(p==='âœŒï¸'&&comp==='âœ‹')) res = 'ÙØ²Øª';
  else res = 'Ø®Ø³Ø±Øª';
  if(res === 'ÙØ²Øª') applyResult(+10, `ÙØ²Øª +10 â€” Ø®ØµÙ…: ${comp}`);
  else if(res === 'Ø®Ø³Ø±Øª') applyResult(-5, `Ø®Ø³Ø±Øª -5 â€” Ø®ØµÙ…: ${comp}`);
  else applyResult(0, `ØªØ¹Ø§Ø¯Ù„ â€” Ø®ØµÙ…: ${comp}`);
}
function playSlot(){
  const s=['ğŸ’','ğŸ‹','â­','7ï¸âƒ£'];
  let r = [s[Math.random()*s.length|0], s[Math.random()*s.length|0], s[Math.random()*s.length|0]];
  const mode = getAdminMode();
  if(mode === 'win') r = ['7ï¸âƒ£','7ï¸âƒ£','7ï¸âƒ£'];
  if(mode === 'lose') r = ['ğŸ’','ğŸ‹','â­'];
  if(r[0]===r[1] && r[1]===r[2]) applyResult(+20, `ğŸ° Jackpot +20 ${r.join('')}`);
  else if(r[0]===r[1]||r[1]===r[2]||r[0]===r[2]) applyResult(+5, `ÙÙˆØ² ØµØºÙŠØ± +5 ${r.join('')}`);
  else applyResult(-5, `Ø®Ø³Ø±Øª -5 ${r.join('')}`);
}
let minesGrid = [];
function resetMines(){
  const gridEl = document.getElementById('minesGrid');
  if(!gridEl) return;
  gridEl.innerHTML = '';
  minesGrid = [];
  for(let i=0;i<25;i++){
    const mine = Math.random() < 0.18;
    minesGrid.push(mine);
    const b = document.createElement('button');
    b.style.width='50px'; b.style.height='50px'; b.style.borderRadius='6px';
    b.innerText = 'â“';
    b.onclick = function(){
      if(minesGrid[i]){
        b.innerText='ğŸ’£'; b.style.background='#7f1d1d'; applyResult(-5, 'Ù„ØºÙ… â€” Ø®Ø³Ø±Øª -5');
      } else {
        b.innerText='ğŸ’'; b.style.background='#064e3b'; applyResult(+10, 'Ø¢Ù…Ù† â€” ÙØ²Øª +10');
      }
    };
    gridEl.appendChild(b);
  }
}

/* on first load, ensure a mines grid container exists in DOM for resetMines */
(function ensureMinesContainer(){
  if(!document.getElementById('minesGrid')){
    const div = document.createElement('div');
    div.id = 'minesGrid';
    div.style.display='grid';
    div.style.gridTemplateColumns='repeat(5,50px)';
    div.style.gap='6px';
    div.style.justifyContent='center';
    const gamesCard = document.getElementById('gamesCard');
    if(gamesCard) gamesCard.appendChild(div);
  }
  resetMines();
})();

/* -------------------------
   Secret admin: tap flow + create/login + panel
   ------------------------- */
let taps = 0, tTimer = null;
const logo = document.getElementById('logoTap');
const adminModal = document.getElementById('adminModal');
const adminCreateWrap = document.getElementById('adminCreateWrap');
const adminLoginWrap = document.getElementById('adminLoginWrap');
const adminPanelWrap = document.getElementById('adminPanelWrap');
const adminBadgePlaceholder = document.getElementById('adminBadgePlaceholder');

logo.addEventListener('click', ()=>{
  taps++;
  if(tTimer) clearTimeout(tTimer);
  tTimer = setTimeout(()=> taps = 0, 900);
  if(taps >= 6){
    taps = 0;
    openAdminSecret();
    alert('ØªÙ… ÙƒØ´Ù Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø³Ø±ÙŠØ© Ù„Ù„Ø£Ø¯Ù…ÙŠÙ† (ØªØ¬Ø±ÙŠØ¨ÙŠ)');
  }
});

function openAdminSecret(){
  const stored = getAdminStored();
  adminModal.classList.remove('hidden');
  adminModal.setAttribute('aria-hidden','false');
  if(!stored){
    adminCreateWrap.classList.remove('hidden');
    adminLoginWrap.classList.add('hidden');
    adminPanelWrap.classList.add('hidden');
  } else {
    adminCreateWrap.classList.add('hidden');
    adminLoginWrap.classList.remove('hidden');
    adminPanelWrap.classList.add('hidden');
    document.getElementById('adminLoginName').value = stored.name || '';
  }
}
document.getElementById('closeAdmin').addEventListener('click', ()=>{ adminModal.classList.add('hidden'); adminModal.setAttribute('aria-hidden','true'); });

/* create admin */
document.getElementById('createAdminBtn').addEventListener('click', async ()=>{
  const name = document.getElementById('adminCreateName').value.trim();
  const code = document.getElementById('adminCreateCode').value;
  const code2 = document.getElementById('adminCreateCode2').value;
  const createMsg = document.getElementById('createMsg');
  createMsg.innerText = '';
  if(!name || !code){ createMsg.innerText = 'Ø§Ù…Ù„Ø£ Ø§Ù„Ø§Ø³Ù… Ùˆ Ø§Ù„ÙƒÙˆØ¯'; return; }
  if(code !== code2){ createMsg.innerText = 'Ø§Ù„ÙƒÙˆØ¯ÙŠÙ† ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ÙŠÙ†'; return; }
  const salt = randBase64(12);
  const hash = await sha256Hex(salt + code);
  setAdminStored({name, salt, hash});
  createMsg.innerText = 'ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ù„ØªØ´ÙÙŠØ± Ø¨Ù†Ø¬Ø§Ø­';
  setTimeout(()=>{ openAdminSecret(); }, 700);
});

/* show create from login */
document.getElementById('showCreateBtn').addEventListener('click', ()=>{
  adminLoginWrap.classList.add('hidden');
  adminCreateWrap.classList.remove('hidden');
});

/* login admin */
document.getElementById('loginAdminBtn').addEventListener('click', async ()=>{
  const name = document.getElementById('adminLoginName').value.trim();
  const code = document.getElementById('adminLoginCode').value;
  const loginMsg = document.getElementById('loginMsg');
  loginMsg.innerText = '';
  const stored = getAdminStored();
  if(!stored){ loginMsg.innerText = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø¯Ù…ÙŠÙ† â€” Ø£Ù†Ø´Ø¦ Ø£ÙˆÙ„Ø§Ù‹'; return; }
  if(name !== stored.name){ loginMsg.innerText = 'Ø§Ù„Ø§Ø³Ù… ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚'; return; }
  const hash = await sha256Hex(stored.salt + code);
  if(hash === stored.hash){
    loginMsg.innerText = 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…ÙŠÙ†';
    showAdminPanel(stored.name);
  } else {
    loginMsg.innerText = 'Ø§Ù„ÙƒÙˆØ¯ Ø®Ø§Ø·Ø¦';
  }
});

/* show admin panel after login */
function showAdminPanel(name){
  adminCreateWrap.classList.add('hidden');
  adminLoginWrap.classList.add('hidden');
  adminPanelWrap.classList.remove('hidden');
  document.getElementById('adminNameDisplay').innerText = name;
  adminBadgePlaceholder.innerHTML = `<div class="badge">Admin: ${escapeHtml(name)}</div>`;
  renderUsersList();
  renderAdminMode();
}

/* admin mode control */
document.getElementById('setForceWin').addEventListener('click', ()=>{ setAdminMode('win'); renderAdminMode(); });
document.getElementById('setForceLose').addEventListener('click', ()=>{ setAdminMode('lose'); renderAdminMode(); });
document.getElementById('setNormal').addEventListener('click', ()=>{ setAdminMode('normal'); renderAdminMode(); });
function renderAdminMode(){ document.getElementById('adminModeLabel').innerText = getAdminMode() === 'normal' ? 'Ø¹Ø§Ø¯ÙŠ' : getAdminMode() === 'win' ? 'Ø±Ø¨Ø­ Ø¯Ø§Ø¦Ù…' : 'Ø®Ø³Ø§Ø±Ø© Ø¯Ø§Ø¦Ù…'; }

/* change admin code */
document.getElementById('changeCodeBtn').addEventListener('click', async ()=>{
  const oldC = document.getElementById('oldCode').value;
  const n1 = document.getElementById('newCode').value;
  const n2 = document.getElementById('newCode2').value;
  const msg = document.getElementById('adminActionMsg');
  msg.innerText = '';
  const stored = getAdminStored();
  if(!stored){ msg.innerText = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø¯Ù…ÙŠÙ†'; return; }
  if(!oldC || !n1){ msg.innerText = 'Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„'; return; }
  const oldHash = await sha256Hex(stored.salt + oldC);
  if(oldHash !== stored.hash){ msg.innerText = 'Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø®Ø§Ø·Ø¦'; return; }
  if(n1 !== n2){ msg.innerText = 'Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚'; return; }
  const newSalt = randBase64(12);
  const newHash = await sha256Hex(newSalt + n1);
  setAdminStored({name: stored.name, salt: newSalt, hash: newHash});
  msg.innerText = 'ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„ÙƒÙˆØ¯';
  document.getElementById('oldCode').value=''; document.getElementById('newCode').value=''; document.getElementById('newCode2').value='';
});

/* logout admin */
document.getElementById('logoutAdminBtn').addEventListener('click', ()=>{
  adminPanelWrap.classList.add('hidden');
  adminLoginWrap.classList.remove('hidden');
  document.getElementById('loginMsg').innerText = 'ØªÙ… Ø§Ù„Ø®Ø±ÙˆØ¬';
  adminBadgePlaceholder.innerHTML = '';
});

/* render users list in admin panel */
function renderUsersList(){
  const ul = document.getElementById('usersList');
  const users = loadUsers().slice().reverse();
  ul.innerHTML = '';
  if(users.length===0){ ul.innerHTML = '<div class="muted small">Ù„Ø§ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ø¹Ø¯</div>'; return; }
  users.forEach(u=>{
    const div = document.createElement('div');
    div.className = 'user-item';
    div.innerHTML = `
      <div style="display:flex;gap:10px;align-items:center">
        <div style="width:40px;height:40px;border-radius:8px;background:linear-gradient(45deg,#feda75,#d62976);display:flex;align-items:center;justify-content:center;font-weight:700">${escapeHtml((u.name||'ØŸ').slice(0,2).toUpperCase())}</div>
        <div style="display:flex;flex-direction:column">
          <div style="font-weight:700">${escapeHtml(u.name)}</div>
          <div class="muted small">${escapeHtml(u.email)} Â· ${escapeHtml(u.role)}</div>
        </div>
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px">
        <div style="font-weight:800">${u.balance}</div>
        <div style="display:flex;gap:6px">
          <button class="chip" onclick="adminAdjustBalance('${u.id}',+10)">+10</button>
          <button class="chip" onclick="adminAdjustBalance('${u.id}',-10)">-10</button>
          <button class="chip" onclick="adminEditUser('${u.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
        </div>
      </div>
    `;
    ul.appendChild(div);
  });
}
window.adminAdjustBalance = function(userId, delta){
  const users = loadUsers();
  const idx = users.findIndex(x=>x.id===userId);
  if(idx===-1) return alert('Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
  users[idx].balance = Math.max(0, (users[idx].balance||0) + delta);
  saveUsers(users);
  renderUsersList();
  // sync if current user
  const cur = loadCurrentUser();
  if(cur && cur.id === userId){ saveCurrentUser(users[idx]); showUser(); }
  pushNotif(`Admin Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ø±ØµÙŠØ¯: ${users[idx].name} (${delta>0? '+'+delta:delta})`);
};
window.adminEditUser = function(userId){
  const users = loadUsers();
  const idx = users.findIndex(x=>x.id===userId);
  if(idx===-1) return;
  const name = prompt('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', users[idx].name);
  if(name===null) return;
  users[idx].name = name;
  saveUsers(users);
  renderUsersList();
  pushNotif(`Admin Ø¹Ø¯Ù‘Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${users[idx].name}`);
};

/* listen to storage events for cross-tab notifications */
window.addEventListener('storage', (e)=>{
  if(e.key === 'insta_last_notif' || e.key === 'insta_last_tx'){
    document.getElementById('notifyDot').classList.remove('hidden');
    const n = JSON.parse(localStorage.getItem('insta_last_notif')||'{}');
    if(n && n.m) document.getElementById('adminNotif').innerText = `${n.t.split('T')[0]} â€” ${n.m}`;
    // if admin panel open, refresh users list
    if(!adminPanelWrap.classList.contains('hidden')) renderUsersList();
  }
});

/* init admin label if exists when logged (but we only show after login) */
(function init(){
  const n = JSON.parse(localStorage.getItem('insta_last_notif')||'{}');
  if(n && n.m) document.getElementById('adminNotif').innerText = `${n.t.split('T')[0]} â€” ${n.m}`;
})();

/* helper */
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }

/* close modals by clicking background */
document.getElementById('depositModal').addEventListener('click', (e)=>{ if(e.target === document.getElementById('depositModal')) closeDeposit(); });
document.getElementById('withdrawModal').addEventListener('click', (e)=>{ if(e.target === document.getElementById('withdrawModal')) closeWithdraw(); });
document.getElementById('adminModal').addEventListener('click', (e)=>{ if(e.target === document.getElementById('adminModal')){ adminModal.classList.add('hidden'); adminModal.setAttribute('aria-hidden','true'); } });

/* expose some functions to global for inline usage */
window.openDeposit = openDeposit;
window.openWithdraw = openWithdraw;
window.useAgent = useAgent;
window.resetMines = resetMines;

/* end of script */
</script>
</body>
</html>
