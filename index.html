<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>INSTAPlay â€” Admin Secret + Encrypted Code</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{--ig1:#feda75;--ig2:#fa7e1e;--ig3:#d62976;--ig4:#962fbf}
  *{box-sizing:border-box}
  body{margin:0;font-family:"Tajawal",sans-serif;background:linear-gradient(135deg,var(--ig1),var(--ig2),var(--ig3),var(--ig4));min-height:100vh;color:#fff;padding:18px}
  .wrap{max-width:420px;margin:0 auto}
  header{display:flex;justify-content:space-between;align-items:center;background:rgba(0,0,0,0.12);padding:10px;border-radius:12px}
  #logo{display:flex;gap:10px;align-items:center;cursor:pointer}
  #logo .icon{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:linear-gradient(45deg,var(--ig3),var(--ig4));font-weight:800}
  .badge{background:rgba(255,255,255,0.08);padding:6px 8px;border-radius:10px;font-size:13px}
  .card{background:rgba(0,0,0,0.36);padding:14px;border-radius:12px;margin-top:14px;box-shadow:0 8px 30px rgba(0,0,0,0.25)}
  input,button{width:100%;padding:10px;border-radius:10px;border:0;background:rgba(255,255,255,0.06);color:#fff;font-size:15px;margin-top:8px}
  button.primary{background:linear-gradient(90deg,var(--ig3),var(--ig4));font-weight:700;cursor:pointer}
  .muted{font-size:13px;color:rgba(255,255,255,0.85);margin-top:6px}
  .hidden{display:none}
  /* admin modal */
  .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:9999}
  .modal .panel{width:94%;max-width:420px;background:#0b0b0b;padding:16px;border-radius:12px}
  .row{display:flex;gap:8px}
  .small{font-size:13px}
  .danger{background:linear-gradient(90deg,#ff4d6d,#ff7b9a)}
  .ok{background:linear-gradient(90deg,#34d399,#10b981)}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div id="logo" title="Ø§Ø¶ØºØ· 6 Ù…Ø±Ø§Øª Ù„ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…ÙŠÙ†">
        <div class="icon">IP</div>
        <div>
          <div style="font-weight:800">INSTAPlay</div>
          <div style="font-size:13px;color:rgba(255,255,255,0.85)">Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ù…Ø±Ù‡Ù†Ø§Øª â€” Ù‡Ø§ØªÙ</div>
        </div>
      </div>
      <div id="adminBadgeWrap">
        <!-- Ø³ÙŠØªÙ… ÙˆØ¶Ø¹ Ø§Ø³Ù… Ø§Ù„Ø£Ø¯Ù…ÙŠÙ† Ù‡Ù†Ø§ ÙÙ‚Ø· Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
      </div>
    </header>

    <!-- auth card -->
    <div class="card" id="authCard">
      <div class="muted">Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ</div>
      <input id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
      <input id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
      <input id="pass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (Ù…Ø­Ù„ÙŠØ©)">
      <button id="registerBtn" class="primary">ØªØ³Ø¬ÙŠÙ„ & Ø¯Ø®ÙˆÙ„</button>
      <div class="muted small">Ø¨Ø§Ù„Ø¶ØºØ· Ø³ÙŠÙØ®Ø²Ù† Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø­Ù„ÙŠÙ‹Ø§ (demo).</div>
    </div>

    <!-- dashboard -->
    <div class="card hidden" id="dashCard">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="font-weight:800" id="uName">-</div>
          <div class="muted small">Ù…Ø¹Ø±Ù‘Ù: <span id="uId">-</span></div>
        </div>
        <div style="text-align:right">
          <div class="muted small">Ø§Ù„Ø±ØµÙŠØ¯</div>
          <div style="font-weight:900;font-size:18px" id="uBal">0</div>
        </div>
      </div>
    </div>

    <!-- Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ù…Ø®ØªØµØ±Ø© (Ù…Ø«Ø§Ù„) -->
    <div class="card hidden" id="gamesCard">
      <h3>Ø£Ù„Ø¹Ø§Ø¨ (ØªØ¬Ø±ÙŠØ¨ÙŠ)</h3>
      <div class="muted small">ÙƒÙ„ Ù„Ø¹Ø¨Ø© ØªØ¹Ø¯Ù‘Ù„ Ø§Ù„Ø±ØµÙŠØ¯ ÙÙˆØ±Ù‹Ø§ ÙˆØªØ¹ÙƒØ³ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø¯Ù…ÙŠÙ†</div>
      <div style="margin-top:10px">
        <button onclick="playCoin('Heads')">ğŸª™ Coin â€” Ø§Ø®ØªØ§Ø± Heads</button>
        <button onclick="playCoin('Tails')">ğŸª™ Coin â€” Ø§Ø®ØªØ§Ø± Tails</button>
        <button onclick="playDice()">ğŸ² Dice</button>
        <button onclick="playRPS('âœŠ')">âœŠ RPS</button>
        <button onclick="playSlot()">ğŸ° Slot</button>
        <button onclick="resetMines()">ğŸ’£ Reset Mines</button>
      </div>
      <div id="gameMsg" class="muted small" style="margin-top:8px"></div>
    </div>
  </div>

  <!-- Admin modal (secret) -->
  <div id="adminModal" class="modal hidden" aria-hidden="true">
    <div class="panel">
      <div id="adminCreateWrap" class="hidden">
        <h3>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø£Ø¯Ù…ÙŠÙ† (Ø³Ø±ÙŠ)</h3>
        <div class="muted small">Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø£Ø¯Ù…ÙŠÙ† ÙˆÙƒÙˆØ¯ Ø³Ø±ÙŠ - Ø³ÙŠÙØ´ÙØ± ÙˆÙŠÙØ®Ø²Ù† Ù…Ø­Ù„ÙŠÙ‹Ø§</div>
        <input id="adminCreateName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ø¯Ù…ÙŠÙ† Ø§Ù„Ø°ÙŠ Ø³ÙŠÙØ¹Ø±Ø¶ ÙÙ‚Ø·">
        <input id="adminCreateCode" type="password" placeholder="Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø±ÙŠ">
        <input id="adminCreateCode2" type="password" placeholder="ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯">
        <div class="row">
          <button id="createAdminBtn" class="primary">Ø¥Ù†Ø´Ø§Ø¡ & ØªØ´ÙÙŠØ±</button>
          <button id="cancelCreate" class="danger">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
        <div id="createMsg" class="muted small"></div>
      </div>

      <div id="adminLoginWrap" class="hidden">
        <h3>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…ÙŠÙ†</h3>
        <div class="muted small">Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø£Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„ÙƒÙˆØ¯</div>
        <input id="adminLoginName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ø¯Ù…ÙŠÙ†">
        <input id="adminLoginCode" type="password" placeholder="Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø±ÙŠ">
        <div class="row">
          <button id="loginAdminBtn" class="primary">Ø¯Ø®ÙˆÙ„</button>
          <button id="showCreateBtn" class="ok">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
        </div>
        <div id="loginMsg" class="muted small"></div>
      </div>

      <div id="adminPanelWrap" class="hidden">
        <h3>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…ÙŠÙ†</h3>
        <div class="muted small">Ø§Ù„Ø§Ø³Ù…: <b id="adminNameDisplay">-</b></div>
        <div style="margin-top:10px">
          <div class="muted small">ØªØºÙŠÙŠØ± Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ:</div>
          <input id="adminSetBal" type="number" placeholder="Ø£Ø¯Ø®Ù„ Ø±ØµÙŠØ¯ Ø¬Ø¯ÙŠØ¯">
          <button id="adminSaveBal" class="primary">Ø­ÙØ¸ Ø§Ù„Ø±ØµÙŠØ¯</button>
        </div>
        <div style="margin-top:10px">
          <div class="muted small">ÙˆØ¶Ø¹ Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ø§Ù…:</div>
          <div class="row">
            <button id="setForceWin" class="">Ø±Ø¨Ø­ Ø¯Ø§Ø¦Ù…</button>
            <button id="setForceLose" class="">Ø®Ø³Ø§Ø±Ø© Ø¯Ø§Ø¦Ù…</button>
            <button id="setNormal" class="ok">Ø¹Ø§Ø¯ÙŠ</button>
          </div>
          <div class="muted small" style="margin-top:8px">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ: <b id="adminModeLabel">Ø¹Ø§Ø¯ÙŠ</b></div>
        </div>
        <div style="margin-top:12px">
          <div class="muted small">ØªØºÙŠÙŠØ± ÙƒÙˆØ¯ Ø§Ù„Ø£Ø¯Ù…ÙŠÙ† (ÙŠØªØ·Ù„Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…):</div>
          <input id="oldCode" type="password" placeholder="Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…">
          <input id="newCode" type="password" placeholder="Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
          <input id="newCode2" type="password" placeholder="ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
          <div class="row">
            <button id="changeCodeBtn" class="primary">ØªØºÙŠÙŠØ± Ø§Ù„ÙƒÙˆØ¯</button>
            <button id="logoutAdminBtn" class="danger">Ø®Ø±ÙˆØ¬ Ø§Ù„Ø£Ø¯Ù…ÙŠÙ†</button>
          </div>
          <div id="adminActionMsg" class="muted small"></div>
        </div>
        <div style="margin-top:12px">
          <button id="closeAdminModal" class="">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      </div>
    </div>
  </div>

<script>
/* ---------- Helpers: hashing + base64 ---------- */
async function sha256Hex(message){
  const enc = new TextEncoder();
  const data = enc.encode(message);
  const hash = await crypto.subtle.digest('SHA-256', data);
  const arr = Array.from(new Uint8Array(hash));
  return arr.map(b=>b.toString(16).padStart(2,'0')).join('');
}
function randBase64(lenBytes=12){
  const a=new Uint8Array(lenBytes);
  crypto.getRandomValues(a);
  // base64
  let s='';
  for(let i=0;i<a.length;i++) s += String.fromCharCode(a[i]);
  return btoa(s);
}

/* ---------- Admin storage format ----------
  localStorage key: "insta_admin"
  value: JSON.stringify({name, salt, hash})
  where hash = sha256Hex(salt + code)
-------------------------------------------- */

function getAdminStored(){ try{ return JSON.parse(localStorage.getItem('insta_admin')||'null'); }catch(e){return null;} }
function setAdminStored(obj){ localStorage.setItem('insta_admin', JSON.stringify(obj)); }

/* ---------- User (demo) ---------- */
function saveUser(u){ localStorage.setItem('insta_user_demo', JSON.stringify(u)); }
function loadUser(){ try{return JSON.parse(localStorage.getItem('insta_user_demo')||'null')}catch(e){return null;} }

/* ---------- UI refs ---------- */
const logo = document.getElementById('logo');
const adminModal = document.getElementById('adminModal');
const adminCreateWrap = document.getElementById('adminCreateWrap');
const adminLoginWrap = document.getElementById('adminLoginWrap');
const adminPanelWrap = document.getElementById('adminPanelWrap');

const adminBadgeWrap = document.getElementById('adminBadgeWrap');

/* ---------- tap secret ---------- */
let taps=0, tTimer=null;
logo.addEventListener('click', ()=>{
  taps++;
  if(tTimer) clearTimeout(tTimer);
  tTimer = setTimeout(()=> taps = 0, 900);
  if(taps >= 6){
    taps = 0;
    openAdminSecret();
  }
});

/* ---------- open secret modal ---------- */
function openAdminSecret(){
  const a = getAdminStored();
  adminModal.classList.remove('hidden');
  adminModal.setAttribute('aria-hidden','false');
  // decide view
  if(!a){
    // show create
    adminCreateWrap.classList.remove('hidden');
    adminLoginWrap.classList.add('hidden');
    adminPanelWrap.classList.add('hidden');
  } else {
    adminCreateWrap.classList.add('hidden');
    adminLoginWrap.classList.remove('hidden');
    adminPanelWrap.classList.add('hidden');
    document.getElementById('adminLoginName').value = a.name || '';
    document.getElementById('loginMsg').innerText = '';
  }
}

/* ---------- create admin ---------- */
document.getElementById('createAdminBtn').addEventListener('click', async ()=>{
  const name = document.getElementById('adminCreateName').value.trim();
  const code = document.getElementById('adminCreateCode').value;
  const code2 = document.getElementById('adminCreateCode2').value;
  const msg = document.getElementById('createMsg');
  msg.innerText = '';
  if(!name || !code) { msg.innerText = 'Ø§Ù„Ù…Ø±Ø¬Ùˆ Ù…Ù„Ø¡ Ø§Ù„Ø§Ø³Ù… Ùˆ Ø§Ù„ÙƒÙˆØ¯'; return; }
  if(code !== code2){ msg.innerText = 'ÙƒÙ„Ø§ Ø§Ù„ÙƒÙˆØ¯ÙŠÙ† ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ÙŠÙ†'; return; }
  const salt = randBase64(12);
  const hash = await sha256Hex(salt + code);
  setAdminStored({name, salt, hash});
  msg.innerText = 'ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ù„ØªØ´ÙÙŠØ± Ø¨Ù†Ø¬Ø§Ø­';
  // auto show login panel after short delay
  setTimeout(()=>{ openAdminSecret(); }, 800);
});

/* cancel create */
document.getElementById('cancelCreate').addEventListener('click', ()=>{
  adminModal.classList.add('hidden');
});

/* ---------- admin login ---------- */
document.getElementById('loginAdminBtn').addEventListener('click', async ()=>{
  const name = document.getElementById('adminLoginName').value.trim();
  const code = document.getElementById('adminLoginCode').value;
  const msg = document.getElementById('loginMsg');
  msg.innerText = '';
  const stored = getAdminStored();
  if(!stored){ msg.innerText = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø¯Ù…ÙŠÙ†ØŒ Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹.'; return; }
  if(name !== stored.name){ msg.innerText = 'Ø§Ù„Ø§Ø³Ù… ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚'; return; }
  const hash = await sha256Hex(stored.salt + code);
  if(hash === stored.hash){
    // success
    msg.innerText = 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…ÙŠÙ†';
    showAdminPanel(stored.name);
  } else {
    msg.innerText = 'Ø§Ù„ÙƒÙˆØ¯ Ø®Ø§Ø·Ø¦';
  }
});

/* ---------- show admin panel after login ---------- */
let adminState = {mode:'normal'}; // modes: normal | win | lose
function showAdminPanel(name){
  adminCreateWrap.classList.add('hidden');
  adminLoginWrap.classList.add('hidden');
  adminPanelWrap.classList.remove('hidden');
  document.getElementById('adminNameDisplay').innerText = name;
  adminState.mode = localStorage.getItem('insta_admin_mode') || 'normal';
  renderAdminMode();
  // show badge with admin name only (no sensitive info)
  adminBadgeWrap.innerHTML = `<div class="badge">Admin: ${escapeHtml(name)}</div>`;
  document.getElementById('adminActionMsg').innerText = '';
  document.getElementById('adminModal').scrollTop = 0;
}

/* ---------- admin mode controls ---------- */
function renderAdminMode(){
  document.getElementById('adminModeLabel').innerText = adminState.mode === 'normal' ? 'Ø¹Ø§Ø¯ÙŠ' : adminState.mode === 'win' ? 'Ø±Ø¨Ø­ Ø¯Ø§Ø¦Ù…' : 'Ø®Ø³Ø§Ø±Ø© Ø¯Ø§Ø¦Ù…';
  localStorage.setItem('insta_admin_mode', adminState.mode);
}
document.getElementById('setForceWin').addEventListener('click', ()=>{ adminState.mode='win'; renderAdminMode(); });
document.getElementById('setForceLose').addEventListener('click', ()=>{ adminState.mode='lose'; renderAdminMode(); });
document.getElementById('setNormal').addEventListener('click', ()=>{ adminState.mode='normal'; renderAdminMode(); });

/* ---------- change code (requires old code) ---------- */
document.getElementById('changeCodeBtn').addEventListener('click', async ()=>{
  const oldC = document.getElementById('oldCode').value;
  const n1 = document.getElementById('newCode').value;
  const n2 = document.getElementById('newCode2').value;
  const msg = document.getElementById('adminActionMsg');
  msg.innerText = '';
  const stored = getAdminStored();
  if(!stored){ msg.innerText = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø¯Ù…ÙŠÙ†.'; return; }
  if(!oldC || !n1) { msg.innerText = 'Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©'; return; }
  const oldHash = await sha256Hex(stored.salt + oldC);
  if(oldHash !== stored.hash){ msg.innerText = 'Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø®Ø§Ø·Ø¦'; return; }
  if(n1 !== n2){ msg.innerText = 'Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚'; return; }
  // create new salt+hash
  const newSalt = randBase64(12);
  const newHash = await sha256Hex(newSalt + n1);
  setAdminStored({name: stored.name, salt: newSalt, hash: newHash});
  msg.innerText = 'ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­';
  // clear inputs
  document.getElementById('oldCode').value=''; document.getElementById('newCode').value=''; document.getElementById('newCode2').value='';
});

/* ---------- admin logout ---------- */
document.getElementById('logoutAdminBtn').addEventListener('click', ()=>{
  adminBadgeWrap.innerHTML = '';
  adminPanelWrap.classList.add('hidden');
  adminLoginWrap.classList.remove('hidden');
  document.getElementById('loginMsg').innerText = 'ØªÙ… Ø§Ù„Ø®Ø±ÙˆØ¬';
});

/* close admin modal */
document.getElementById('closeAdminModal').addEventListener('click', ()=>{
  adminModal.classList.add('hidden');
  adminModal.setAttribute('aria-hidden','true');
});

/* show "create new" inside login (in case they want to recreate) */
document.getElementById('showCreateBtn').addEventListener('click', ()=>{
  adminLoginWrap.classList.add('hidden');
  adminCreateWrap.classList.remove('hidden');
});

/* ---------- Basic demo user register/login ---------- */
document.getElementById('registerBtn').addEventListener('click', ()=>{
  const name = document.getElementById('name').value.trim() || 'Ù„Ø§Ø³Ù…';
  const email = document.getElementById('email').value.trim() || '';
  const pass = document.getElementById('pass').value || '';
  const id = 'u'+Date.now().toString(36).slice(-6);
  const user = {id,name,email,balance:100,created: new Date().toISOString()};
  saveUser(user);
  showUser(user);
});
function showUser(u){
  if(!u) u = loadUser();
  if(!u) return;
  document.getElementById('dashCard').classList.remove('hidden');
  document.getElementById('gamesCard').classList.remove('hidden');
  document.getElementById('uName').innerText = u.name;
  document.getElementById('uId').innerText = u.id;
  document.getElementById('uBal').innerText = u.balance;
}

/* load existing user on start */
showUser(loadUser());

/* ---------- Game functions (connect to admin mode and update user) ---------- */
async function applyResult(delta, txt){
  const u = loadUser();
  if(!u){ alert('Ø³Ø¬Ù‘Ù„ Ø£ÙˆÙ„Ù‹Ø§'); return; }
  u.balance = Math.max(0, (u.balance||0) + delta);
  saveUser(u);
  showUser(u);
  document.getElementById('gameMsg').innerText = txt;
}

/* coin */
async function playCoin(choice){
  const admin = getAdminStored();
  let mode = localStorage.getItem('insta_admin_mode') || 'normal';
  let result = Math.random() < 0.5 ? 'Heads' : 'Tails';
  if(mode === 'win') result = choice;
  if(mode === 'lose') result = (choice === 'Heads' ? 'Tails' : 'Heads');
  if(result === choice) await applyResult(+10, `ÙØ²Øª! (${result})`);
  else await applyResult(-5, `Ø®Ø³Ø±Øª (${result})`);
}

/* dice */
async function playDice(){
  let mode = localStorage.getItem('insta_admin_mode') || 'normal';
  let r = Math.floor(Math.random()*6)+1;
  if(mode === 'win') r = 6;
  if(mode === 'lose') r = 1;
  if(r === 6) await applyResult(+10, `ğŸ‰ 6 - ÙØ²Øª`);
  else if(r >= 4) await applyResult(+5, `+5 (Ø§Ù„Ù†ØªÙŠØ¬Ø© ${r})`);
  else await applyResult(-5, `Ø®Ø³Ø±Øª (Ø§Ù„Ù†ØªÙŠØ¬Ø© ${r})`);
}

/* RPS */
async function playRPS(p){
  const opts=['âœŠ','âœ‹','âœŒï¸'];
  let comp = opts[Math.floor(Math.random()*3)];
  const mode = localStorage.getItem('insta_admin_mode') || 'normal';
  if(mode === 'win'){ comp = (p === 'âœŠ' ? 'âœŒï¸' : p === 'âœ‹' ? 'âœŠ' : 'âœ‹'); }
  if(mode === 'lose'){ comp = (p === 'âœŠ' ? 'âœ‹' : p === 'âœ‹' ? 'âœŒï¸' : 'âœŠ'); }
  let res='';
  if(p === comp) res = 'ØªØ¹Ø§Ø¯Ù„';
  else if((p==='âœŠ'&&comp==='âœŒï¸')||(p==='âœ‹'&&comp==='âœŠ')||(p==='âœŒï¸'&&comp==='âœ‹')) res = 'ÙØ²Øª';
  else res = 'Ø®Ø³Ø±Øª';
  if(res==='ÙØ²Øª') await applyResult(+10, `ÙØ²Øª â€” Ø®ØµÙ…: ${comp}`);
  else if(res==='Ø®Ø³Ø±Øª') await applyResult(-5, `Ø®Ø³Ø±Øª â€” Ø®ØµÙ…: ${comp}`);
  else await applyResult(0, `ØªØ¹Ø§Ø¯Ù„ â€” Ø®ØµÙ…: ${comp}`);
}

/* Slot */
async function playSlot(){
  const s=['ğŸ’','ğŸ‹','â­','7ï¸âƒ£'];
  let r = [s[Math.random()*s.length|0], s[Math.random()*s.length|0], s[Math.random()*s.length|0]];
  const mode = localStorage.getItem('insta_admin_mode') || 'normal';
  if(mode === 'win') r = ['7ï¸âƒ£','7ï¸âƒ£','7ï¸âƒ£'];
  if(mode === 'lose') r = ['ğŸ’','ğŸ‹','â­'];
  if(r[0]===r[1] && r[1]===r[2]) await applyResult(+20, `Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰ ${r.join('')}`);
  else if(r[0]===r[1]||r[1]===r[2]||r[0]===r[2]) await applyResult(+5, `ÙÙˆØ² ØµØºÙŠØ± ${r.join('')}`);
  else await applyResult(-5, `Ø®Ø³Ø±Øª ${r.join('')}`);
}

/* Mines (simple) */
function resetMines(){
  const grid = document.getElementById('minesGrid');
  grid.innerHTML='';
  const mines = [];
  for(let i=0;i<25;i++){
    const isMine = Math.random() < 0.18;
    mines.push(isMine);
    const b = document.createElement('button');
    b.style.width='50px'; b.style.height='50px'; b.style.borderRadius='6px';
    b.innerText = 'â“';
    b.onclick = async ()=>{
      if(isMine){ await applyResult(-5, 'ğŸ’¥ Boom â€” Ù„ØºÙ…!'); b.innerText='ğŸ’£'; b.style.background='#7f1d1d'; }
      else { await applyResult(+10, 'ğŸ’ Ø¢Ù…ÙÙ†'); b.innerText='ğŸ’'; b.style.background='#064e3b'; }
    };
    grid.appendChild(b);
  }
}

/* ---------- admin set balance (applies to current demo user) ---------- */
document.getElementById('adminSaveBal').addEventListener('click', ()=>{
  const val = parseInt(document.getElementById('adminSetBal').value);
  if(isNaN(val)){ document.getElementById('adminActionMsg').innerText = 'Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø©'; return; }
  const u = loadUser();
  if(!u){ document.getElementById('adminActionMsg').innerText = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ø­Ø§Ù„ÙŠ'; return; }
  u.balance = val; saveUser(u); showUser(u);
  document.getElementById('adminActionMsg').innerText = 'ØªÙ… Ø¶Ø¨Ø· Ø§Ù„Ø±ØµÙŠØ¯';
});

/* small helper */
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }

/* allow closing modal by clicking background */
adminModal.addEventListener('click', (e)=>{
  if(e.target === adminModal){
    adminModal.classList.add('hidden');
    adminModal.setAttribute('aria-hidden','true');
  }
});

/* init: load admin mode label if any */
(function init(){
  const m = localStorage.getItem('insta_admin_mode') || 'normal';
  adminState.mode = m;
  renderAdminMode();
  // if admin stored but no badge (not logged) do nothing â€” badge only after login
})();
</script>
</body>
</html>
